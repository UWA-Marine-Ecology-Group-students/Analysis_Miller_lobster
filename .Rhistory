# Import 2018 length data----
dat.2018<-gs_title("Lobsters_data_2018_All")%>%
gs_read_csv(ws = "Lobster.var",col_types = "cccccccccccccccccnnnncccccc")%>%
mutate(trip.day.trap=paste(Trip,Day,Trap.ID,sep="."))%>%  #Trap.ID
mutate(Source = 'Ash')%>%
mutate(Fisher = NA)%>%
glimpse()
dat.length.2018<-dat.2018%>%
mutate(Count=1)%>% # Create count for abundance calcs
# I think we need to keep NA's in Carapace.length and tag.number BG 07/05/19
filter(!(is.na(Carapace.length)&is.na(Tag.number)&is.na(Colour)))%>% # now filters out where all are blank, 35 individuals have colour but no other details
mutate(Carapace.length=as.numeric(as.character(Carapace.length)))%>%
mutate(Colour=str_replace_all(.$Colour,c("W"="White", "R"="Red")))%>%
mutate(Sex=str_replace_all(.$Sex, c("M"="Male", "F"="Female","U"="Unknown")))%>%
mutate(Sex=if_else((!is.na(Colour)&!Sex%in%c("Female","Male")),"Unknown",Sex))%>%
# Fix Damaged data
mutate(Damage.old.a=if_else(Damage.new.a==9,0,Damage.old.a))%>%
mutate(Damage.new.L=if_else(Damage.new.a==9,0,Damage.new.L))%>%
mutate(Damage.old.L=if_else(Damage.new.a==9,0,Damage.old.L))%>%
mutate(Damage.new.a=if_else(Damage.new.a==9,0,Damage.new.a))%>%
replace_na(list(Damage.old.a = 0, Damage.old.L = 0,Damage.new.a = 0, Damage.new.L = 0,Sex="Unknown",Colour="Unknown"))%>%
mutate(Total.damage=(Damage.old.a+Damage.old.L+Damage.new.a+Damage.new.L))%>%
# select(Trip, Trap.ID, Day, Date, Tag.number, Recapture, Trap.Number, Carapace.length, Sex, Colour, trip.day.trap, Source, Fisher,Total.damage)%>%
glimpse()
# Check formating of Lobster data
unique(dat.length.2018$Recapture) #  NA TRUE
unique(dat.length.2018$Sex) # "Female" "Male"   "Unknown"
unique(dat.length.2018$Colour) # "Red"   "White" "Unknown"
unique(dat.length.2018$Outlier) #  NA  "y"
unique(dat.length.2018$Setose.state) # "I" NA  "E" "M"
# Damage data
unique(dat.length.2018$Damage.new.a) # 0 1 2 - have fixed more than 2 antennas
unique(dat.length.2018$Total.damage)%>%sort()
length(unique(dat.length.2018$Tag.number)) # 7537 tagged individuals
length(dat.length.2018$Carapace.length) # 9318 total indiviuals caught
# Things that should actually be in the metadata not the lobster data
met<-dat.2018%>%
dplyr::select(Trip,Location,Trap.ID,Day,Date,Trap.Number,Trap.Type,Day.Pull,Pot.Remarks,PWO,WKW,PWF,trip.day.trap,Source,Fisher)%>%
distinct()
duplicates<-met%>%
group_by(trip.day.trap)%>%
summarise(n=n())%>%
filter(n>1)
# Things that should actually be in the metadata not the lobster data
additional.info<-dat.2018%>%
dplyr::select(Trip,Location,Trap.ID,Day,Date,Trap.Number,Trap.Type,Day.Pull,Pot.Remarks,PWO,WKW,PWF,trip.day.trap,Source,Fisher)%>%
distinct()
dat.pot.2018<-gs_title("Lobsters_data_2018_All")%>% # To use GoogleSheets
gs_read_csv(ws = "Pot.var")
# Import 2018 pot data----
dat.pot.2018<-gs_title("Lobsters_data_2018_All")%>% # To use GoogleSheets
gs_read_csv(ws = "Pot.var",col_types = "nccnccnnccnnn")%>%
mutate(trip.day.trap=paste(Trip,Day,Trap.ID,sep="."))%>%
mutate(Site.Name=str_replace_all(.$Site.Name,c( "SM"="Seven Mile", "DM"="Davids Marks",  "RM"="Rivermouth", "IR"="Irwin Reef", "LR"="Long Reef", "SD"="South Dummy", "LH"="Little Horseshoe", "CHin1_"="Cliff Head Mid","CHin2_"="Cliff Head South","CHout1_" = "Cliff Head OUT1","CHout2_" = "Cliff Head North", "JB"="Jim Bailey", "GR"="Golden Ridge", "SR"="South Rig", "WL"="Whites Lump")))%>%
filter(Johns=="No")%>% # turn off when I add in john's data (if ever)
dplyr::rename(Latitude=Latitude.y, Longitude=Longitude.x)%>%
mutate(Latitude=as.numeric(Latitude))%>%
mutate(Longitude=as.numeric(Longitude))%>%
glimpse()
#Create "sites" for 2018 Data----
sites.2018<-dat.pot.2018%>%
distinct(Trap.ID,Site.Name)%>% #Keeps only distinct rows (Trap.ID & Site.Name)
mutate(Trap.ID=as.character(Trap.ID))%>%
dplyr::rename(Site=Site.Name)%>%
glimpse()
View(sites.2018)
dat.length.2018<-dat.2018%>%
mutate(Count=1)%>% # Create count for abundance calcs
# I think we need to keep NA's in Carapace.length and tag.number BG 07/05/19
filter(!(is.na(Carapace.length)&is.na(Tag.number)&is.na(Colour)))%>% # now filters out where all are blank, 35 individuals have colour but no other details
mutate(Carapace.length=as.numeric(as.character(Carapace.length)))%>%
mutate(Colour=str_replace_all(.$Colour,c("W"="White", "R"="Red")))%>%
mutate(Sex=str_replace_all(.$Sex, c("M"="Male", "F"="Female","U"="Unknown")))%>%
mutate(Sex=if_else((!is.na(Colour)&!Sex%in%c("Female","Male")),"Unknown",Sex))%>%
# Fix Damaged data
mutate(Damage.old.a=if_else(Damage.new.a==9,0,Damage.old.a))%>%
mutate(Damage.new.L=if_else(Damage.new.a==9,0,Damage.new.L))%>%
mutate(Damage.old.L=if_else(Damage.new.a==9,0,Damage.old.L))%>%
mutate(Damage.new.a=if_else(Damage.new.a==9,0,Damage.new.a))%>%
replace_na(list(Damage.old.a = 0, Damage.old.L = 0,Damage.new.a = 0, Damage.new.L = 0,Sex="Unknown",Colour="Unknown"))%>%
mutate(Total.damage=(Damage.old.a+Damage.old.L+Damage.new.a+Damage.new.L))%>%
dplyr::select(-c(Location,Date,Trap.Type,Day.Pull,Pot.Remarks,PWO,WKW,PWF,Source,Fisher))%>%
glimpse()
dat.length.2018<-dat.2018%>%
mutate(Count=1)%>% # Create count for abundance calcs
# I think we need to keep NA's in Carapace.length and tag.number BG 07/05/19
filter(!(is.na(Carapace.length)&is.na(Tag.number)&is.na(Colour)))%>% # now filters out where all are blank, 35 individuals have colour but no other details
mutate(Carapace.length=as.numeric(as.character(Carapace.length)))%>%
mutate(Colour=str_replace_all(.$Colour,c("W"="White", "R"="Red")))%>%
mutate(Sex=str_replace_all(.$Sex, c("M"="Male", "F"="Female","U"="Unknown")))%>%
mutate(Sex=if_else((!is.na(Colour)&!Sex%in%c("Female","Male")),"Unknown",Sex))%>%
# Fix Damaged data
mutate(Damage.old.a=if_else(Damage.new.a==9,0,Damage.old.a))%>%
mutate(Damage.new.L=if_else(Damage.new.a==9,0,Damage.new.L))%>%
mutate(Damage.old.L=if_else(Damage.new.a==9,0,Damage.old.L))%>%
mutate(Damage.new.a=if_else(Damage.new.a==9,0,Damage.new.a))%>%
replace_na(list(Damage.old.a = 0, Damage.old.L = 0,Damage.new.a = 0, Damage.new.L = 0,Sex="Unknown",Colour="Unknown"))%>%
mutate(Total.damage=(Damage.old.a+Damage.old.L+Damage.new.a+Damage.new.L))%>%
dplyr::select(-c(Date,Trap.Type,Day.Pull,Pot.Remarks,PWO,WKW,PWF,Source,Fisher))%>%
glimpse()
# Things that should actually be in the metadata not the lobster data
additional.info<-dat.2018%>%
dplyr::select(Trip,Location,Trap.ID,Day,Date,Trap.Number,Trap.Type,Day.Pull,Pot.Remarks,PWO,WKW,PWF,trip.day.trap,Source,Fisher)%>%
distinct()
duplicate.remarks<-additional.info%>%
group_by(trip.day.trap)%>%
summarise(n=n())%>%
filter(n>1)
View(dat.pot.2018)
unique(additional.info$trip.day.trap)
length(unique(additional.info$trip.day.trap))
# Import 2018 length data----
dat.2018<-gs_title("Lobsters_data_2018_All")%>%
gs_read_csv(ws = "Lobster.var",col_types = "cccccccccccccccccnnnncccccc")%>%
mutate(trip.day.trap=paste(Trip,Day,Trap.ID,sep="."))%>%  #Trap.ID
mutate(Source = 'ash-millers-masters')%>%
glimpse()
dat.length.2018<-dat.2018%>%
mutate(Count=1)%>% # Create count for abundance calcs
# I think we need to keep NA's in Carapace.length and tag.number BG 07/05/19
filter(!(is.na(Carapace.length)&is.na(Tag.number)&is.na(Colour)))%>% # now filters out where all are blank, 35 individuals have colour but no other details
mutate(Carapace.length=as.numeric(as.character(Carapace.length)))%>%
mutate(Colour=str_replace_all(.$Colour,c("W"="White", "R"="Red")))%>%
mutate(Sex=str_replace_all(.$Sex, c("M"="Male", "F"="Female","U"="Unknown")))%>%
mutate(Sex=if_else((!is.na(Colour)&!Sex%in%c("Female","Male")),"Unknown",Sex))%>%
# Fix Damaged data
mutate(Damage.old.a=if_else(Damage.new.a==9,0,Damage.old.a))%>%
mutate(Damage.new.L=if_else(Damage.new.a==9,0,Damage.new.L))%>%
mutate(Damage.old.L=if_else(Damage.new.a==9,0,Damage.old.L))%>%
mutate(Damage.new.a=if_else(Damage.new.a==9,0,Damage.new.a))%>%
replace_na(list(Damage.old.a = 0, Damage.old.L = 0,Damage.new.a = 0, Damage.new.L = 0,Sex="Unknown",Colour="Unknown"))%>%
mutate(Total.damage=(Damage.old.a+Damage.old.L+Damage.new.a+Damage.new.L))%>%
dplyr::select(-c(Date,Trap.Type,Day.Pull,Pot.Remarks,PWO,WKW,PWF,Source))%>%
glimpse()
# Check formating of Lobster data
unique(dat.length.2018$Recapture) #  NA TRUE
unique(dat.length.2018$Sex) # "Female" "Male"   "Unknown"
unique(dat.length.2018$Colour) # "Red"   "White" "Unknown"
unique(dat.length.2018$Outlier) #  NA  "y"
unique(dat.length.2018$Setose.state) # "I" NA  "E" "M"
# Damage data
unique(dat.length.2018$Damage.new.a) # 0 1 2 - I have fixed when more than 2 antennas damaged
unique(dat.length.2018$Total.damage)%>%sort()
length(unique(dat.length.2018$Tag.number)) # 7537 tagged individuals
length(dat.length.2018$Carapace.length) # 9318 total indiviuals caught
# Things that should actually be in the metadata not the lobster data
additional.info<-dat.2018%>%
dplyr::select(Trip,Location,Trap.ID,Day,Date,Trap.Number,Trap.Type,Day.Pull,Pot.Remarks,PWO,WKW,PWF,trip.day.trap,Source)%>%
distinct()
length(unique(additional.info$trip.day.trap)) # 1440
duplicate.remarks<-additional.info%>%
group_by(trip.day.trap)%>%
summarise(n=n())%>%
filter(n>1)
# Import 2018 pot data----
dat.pot.2018<-gs_title("Lobsters_data_2018_All")%>% # To use GoogleSheets
gs_read_csv(ws = "Pot.var",col_types = "nccnccnnccnnn")%>%
mutate(trip.day.trap=paste(Trip,Day,Trap.ID,sep="."))%>%
mutate(Site.Name=str_replace_all(.$Site.Name,c( "SM"="Seven Mile", "DM"="Davids Marks",  "RM"="Rivermouth", "IR"="Irwin Reef", "LR"="Long Reef", "SD"="South Dummy", "LH"="Little Horseshoe", "CHin1_"="Cliff Head Mid","CHin2_"="Cliff Head South","CHout1_" = "Cliff Head OUT1","CHout2_" = "Cliff Head North", "JB"="Jim Bailey", "GR"="Golden Ridge", "SR"="South Rig", "WL"="Whites Lump")))%>%
filter(Johns=="No")%>% # turn off when I add in john's data (if ever)
dplyr::rename(Latitude=Latitude.y, Longitude=Longitude.x)%>%
mutate(Latitude=as.numeric(Latitude))%>%
mutate(Longitude=as.numeric(Longitude))%>%
glimpse()
unique(dat.pot.2018$trip.day.trap)
length(unique(dat.pot.2018$trip.day.trap))
duplicate.pots<-dat.pot.2018%>%
group_by(trip.day.trap)%>%
dplyr::summarise(n=n())%>%filter(n>1)
length(unique(dat.pot.2018$trip.day.trap)) # 1461
# Import 2018 pot data----
dat.pot.2018<-gs_title("Lobsters_data_2018_All")%>% # To use GoogleSheets
gs_read_csv(ws = "Pot.var",col_types = "nccnccnnccnnn")%>%
mutate(trip.day.trap=paste(Trip,Day,Trap.ID,sep="."))%>%
mutate(Site.Name=str_replace_all(.$Site.Name,c( "SM"="Seven Mile", "DM"="Davids Marks",  "RM"="Rivermouth", "IR"="Irwin Reef", "LR"="Long Reef", "SD"="South Dummy", "LH"="Little Horseshoe", "CHin1_"="Cliff Head Mid","CHin2_"="Cliff Head South","CHout1_" = "Cliff Head OUT1","CHout2_" = "Cliff Head North", "JB"="Jim Bailey", "GR"="Golden Ridge", "SR"="South Rig", "WL"="Whites Lump")))%>%
filter(Johns=="No")%>% # turn off when I add in john's data (if ever)
dplyr::rename(Latitude=Latitude.y, Longitude=Longitude.x)%>%
mutate(Latitude=as.numeric(Latitude))%>%
mutate(Longitude=as.numeric(Longitude))%>%
glimpse()
duplicate.pots<-dat.pot.2018%>%
group_by(trip.day.trap)%>%
dplyr::summarise(n=n())
duplicate.pots<-dat.pot.2018%>%
group_by(trip.day.trap)%>%
dplyr::summarise(n=n())%>%filter(n>1)
View(duplicate.pots)
source('C:/GitHub/Analysis_Miller_lobster/Scripts/1.Import.Data_20190507.R', echo=TRUE)
# Explore catch data----
rm(list=ls()) # Clears memory
# librarys----
library(tidyr)
library(dplyr)
library(googlesheets)
library(stringr)
library(measurements)
library(lubridate)
library(readr)
# Study name----
study<-"Lobster.Data"
# Set work directory----
# work.dir = ("~/Google Drive/Analysis_WRL_Reds_2018/Data") # for Laptop
# work.dir=("~/GitHub/Analysis_Miller_WRL") #for Tim's github
# work.dir=("~/workspace/Analysis_Miller_WRL") #for ecocloud server
work.dir=("C:/GitHub") # For Brooke
work.dir=("Z:/Analysis_Miller_lobster") # FOr Ash's laptop using Git
# Sub directories ----
data.dir<-paste(work.dir,"Data",sep="/")
map.dir<-paste(work.dir,"Map Layers",sep="/")
plots.dir<-paste(work.dir,"Plots",sep="/")
# Import and make data----
# For Rstudio Server
# options(httr_oob_default=TRUE)
# options(httr_oob_default=FALSE) #for desktop
# gs_auth(new_user = TRUE) #only run once
# Import 2018 length data----
dat.2018<-gs_title("Lobsters_data_2018_All")%>%
gs_read_csv(ws = "Lobster.var",col_types = "cccccccccccccccccnnnncccccc")%>%
mutate(trip.day.trap=paste(Trip,Day,Trap.ID,sep="."))%>%  #Trap.ID
mutate(Source = 'ash-millers-masters')%>%
glimpse()
dat.length.2018<-dat.2018%>%
mutate(Count=1)%>% # Create count for abundance calcs
# I think we need to keep NA's in Carapace.length and tag.number BG 07/05/19
filter(!(is.na(Carapace.length)&is.na(Tag.number)&is.na(Colour)))%>% # now filters out where all are blank, 35 individuals have colour but no other details
mutate(Carapace.length=as.numeric(as.character(Carapace.length)))%>%
mutate(Colour=str_replace_all(.$Colour,c("W"="White", "R"="Red")))%>%
mutate(Sex=str_replace_all(.$Sex, c("M"="Male", "F"="Female","U"="Unknown")))%>%
mutate(Sex=if_else((!is.na(Colour)&!Sex%in%c("Female","Male")),"Unknown",Sex))%>%
# Fix Damaged data
mutate(Damage.old.a=if_else(Damage.new.a==9,0,Damage.old.a))%>%
mutate(Damage.new.L=if_else(Damage.new.a==9,0,Damage.new.L))%>%
mutate(Damage.old.L=if_else(Damage.new.a==9,0,Damage.old.L))%>%
mutate(Damage.new.a=if_else(Damage.new.a==9,0,Damage.new.a))%>%
replace_na(list(Damage.old.a = 0, Damage.old.L = 0,Damage.new.a = 0, Damage.new.L = 0,Sex="Unknown",Colour="Unknown"))%>%
mutate(Total.damage=(Damage.old.a+Damage.old.L+Damage.new.a+Damage.new.L))%>%
dplyr::select(-c(Date,Trap.Type,Day.Pull,Pot.Remarks,PWO,WKW,PWF,Source))%>%
glimpse()
# Check formating of Lobster data
unique(dat.length.2018$Recapture) #  NA TRUE
unique(dat.length.2018$Sex) # "Female" "Male"   "Unknown"
unique(dat.length.2018$Colour) # "Red"   "White" "Unknown"
unique(dat.length.2018$Outlier) #  NA  "y"
unique(dat.length.2018$Setose.state) # "I" NA  "E" "M"
# Damage data
unique(dat.length.2018$Damage.new.a) # 0 1 2 - I have fixed when more than 2 antennas damaged
unique(dat.length.2018$Total.damage)%>%sort()
length(unique(dat.length.2018$Tag.number)) # 7537 tagged individuals
length(dat.length.2018$Carapace.length) # 9318 total indiviuals caught
# Things that should actually be in the metadata not the lobster data
additional.info<-dat.2018%>%
dplyr::select(Trip,Location,Trap.ID,Day,Date,Trap.Number,Trap.Type,Day.Pull,Pot.Remarks,PWO,WKW,PWF,trip.day.trap,Source)%>%
distinct()
length(unique(additional.info$trip.day.trap)) # 1440
duplicate.remarks<-additional.info%>%
group_by(trip.day.trap)%>%
summarise(n=n())%>%
filter(n>1)
# Import 2018 pot data----
dat.pot.2018<-gs_title("Lobsters_data_2018_All")%>% # To use GoogleSheets
gs_read_csv(ws = "Pot.var",col_types = "nccnccnnccnnn")%>%
mutate(trip.day.trap=paste(Trip,Day,Trap.ID,sep="."))%>%
mutate(Site.Name=str_replace_all(.$Site.Name,c( "SM"="Seven Mile", "DM"="Davids Marks",  "RM"="Rivermouth", "IR"="Irwin Reef", "LR"="Long Reef", "SD"="South Dummy", "LH"="Little Horseshoe", "CHin1_"="Cliff Head Mid","CHin2_"="Cliff Head South","CHout1_" = "Cliff Head OUT1","CHout2_" = "Cliff Head North", "JB"="Jim Bailey", "GR"="Golden Ridge", "SR"="South Rig", "WL"="Whites Lump")))%>%
filter(Johns=="No")%>% # turn off when I add in john's data (if ever)
dplyr::rename(Latitude=Latitude.y, Longitude=Longitude.x)%>%
mutate(Latitude=as.numeric(Latitude))%>%
mutate(Longitude=as.numeric(Longitude))%>%
glimpse()
dat.pot.2018<-gs_title("Lobsters_data_2018_All")%>% # To use GoogleSheets
gs_read_csv(ws = "Pot.var",col_types = "nccnccnnccnnnc")
# Import 2018 pot data----
dat.pot.2018<-gs_title("Lobsters_data_2018_All")%>% # To use GoogleSheets
gs_read_csv(ws = "Pot.var",col_types = "nccnccnnccnnnc")%>%
mutate(trip.day.trap=paste(Trip,Day,Trap.ID,sep="."))%>%
mutate(Site.Name=str_replace_all(.$Site.Name,c( "SM"="Seven Mile", "DM"="Davids Marks",  "RM"="Rivermouth", "IR"="Irwin Reef", "LR"="Long Reef", "SD"="South Dummy", "LH"="Little Horseshoe", "CHin1_"="Cliff Head Mid","CHin2_"="Cliff Head South","CHout1_" = "Cliff Head OUT1","CHout2_" = "Cliff Head North", "JB"="Jim Bailey", "GR"="Golden Ridge", "SR"="South Rig", "WL"="Whites Lump")))%>%
filter(Johns=="No")%>% # turn off when I add in john's data (if ever)
dplyr::rename(Latitude=Latitude.y, Longitude=Longitude.x)%>%
mutate(Latitude=as.numeric(Latitude))%>%
mutate(Longitude=as.numeric(Longitude))%>%
glimpse()
# Import 2018 pot data----
dat.pot.2018<-gs_title("Lobsters_data_2018_All")%>% # To use GoogleSheets
gs_read_csv(ws = "Pot.var",col_types = "nccnccnnccnnnc")%>%
mutate(trip.day.trap=paste(Trip,Day,Trap.ID,sep="."))%>%
mutate(Site.Name=str_replace_all(.$Site.Name,c( "SM"="Seven Mile", "DM"="Davids Marks",  "RM"="Rivermouth", "IR"="Irwin Reef", "LR"="Long Reef", "SD"="South Dummy", "LH"="Little Horseshoe", "CHin1_"="Cliff Head Mid","CHin2_"="Cliff Head South","CHout1_" = "Cliff Head OUT1","CHout2_" = "Cliff Head North", "JB"="Jim Bailey", "GR"="Golden Ridge", "SR"="South Rig", "WL"="Whites Lump")))%>%
filter(Johns=="No")%>% # turn off when I add in john's data (if ever)
dplyr::rename(Latitude=Latitude.y, Longitude=Longitude.x)%>%
mutate(Latitude=as.numeric(Latitude))%>%
mutate(Longitude=as.numeric(Longitude))%>%
filter(!Comment%in%c("Duplicate"))%>%
glimpse()
length(unique(dat.pot.2018$trip.day.trap)) # 1461
tetst<-anti_join(additional.info,dat.pot.2018)
dat.length.2018<-dat.2018%>%
mutate(Count=1)%>% # Create count for abundance calcs
# I think we need to keep NA's in Carapace.length and tag.number BG 07/05/19
filter(!(is.na(Carapace.length)&is.na(Tag.number)&is.na(Colour)))%>% # now filters out where all are blank, 35 individuals have colour but no other details
mutate(Carapace.length=as.numeric(as.character(Carapace.length)))%>%
mutate(Colour=str_replace_all(.$Colour,c("W"="White", "R"="Red")))%>%
mutate(Sex=str_replace_all(.$Sex, c("M"="Male", "F"="Female","U"="Unknown")))%>%
mutate(Sex=if_else((!is.na(Colour)&!Sex%in%c("Female","Male")),"Unknown",Sex))%>%
# Fix Damaged data
mutate(Damage.old.a=if_else(Damage.new.a==9,0,Damage.old.a))%>%
mutate(Damage.new.L=if_else(Damage.new.a==9,0,Damage.new.L))%>%
mutate(Damage.old.L=if_else(Damage.new.a==9,0,Damage.old.L))%>%
mutate(Damage.new.a=if_else(Damage.new.a==9,0,Damage.new.a))%>%
replace_na(list(Damage.old.a = 0, Damage.old.L = 0,Damage.new.a = 0, Damage.new.L = 0,Sex="Unknown",Colour="Unknown"))%>%
mutate(Total.damage=(Damage.old.a+Damage.old.L+Damage.new.a+Damage.new.L))%>%
dplyr::select(-c(Date,Trap.Type,Day.Pull,Pot.Remarks,PWO,WKW,PWF,Source))%>%
glimpse()
# Import 2018 length data----
dat.2018<-gs_title("Lobsters_data_2018_All")%>%
gs_read_csv(ws = "Lobster.var",col_types = "nccncccccccccccccnnnncccccc")%>%
mutate(trip.day.trap=paste(Trip,Day,Trap.ID,sep="."))%>%  #Trap.ID
mutate(Source = 'ash-millers-masters')%>%
glimpse()
dat.length.2018<-dat.2018%>%
mutate(Count=1)%>% # Create count for abundance calcs
# I think we need to keep NA's in Carapace.length and tag.number BG 07/05/19
filter(!(is.na(Carapace.length)&is.na(Tag.number)&is.na(Colour)))%>% # now filters out where all are blank, 35 individuals have colour but no other details
mutate(Carapace.length=as.numeric(as.character(Carapace.length)))%>%
mutate(Colour=str_replace_all(.$Colour,c("W"="White", "R"="Red")))%>%
mutate(Sex=str_replace_all(.$Sex, c("M"="Male", "F"="Female","U"="Unknown")))%>%
mutate(Sex=if_else((!is.na(Colour)&!Sex%in%c("Female","Male")),"Unknown",Sex))%>%
# Fix Damaged data
mutate(Damage.old.a=if_else(Damage.new.a==9,0,Damage.old.a))%>%
mutate(Damage.new.L=if_else(Damage.new.a==9,0,Damage.new.L))%>%
mutate(Damage.old.L=if_else(Damage.new.a==9,0,Damage.old.L))%>%
mutate(Damage.new.a=if_else(Damage.new.a==9,0,Damage.new.a))%>%
replace_na(list(Damage.old.a = 0, Damage.old.L = 0,Damage.new.a = 0, Damage.new.L = 0,Sex="Unknown",Colour="Unknown"))%>%
mutate(Total.damage=(Damage.old.a+Damage.old.L+Damage.new.a+Damage.new.L))%>%
dplyr::select(-c(Date,Trap.Type,Day.Pull,Pot.Remarks,PWO,WKW,PWF,Source))%>%
glimpse()
test<-anti_join(additional.info,dat.pot.2018)
# Import 2018 length data----
dat.2018<-gs_title("Lobsters_data_2018_All")%>%
gs_read_csv(ws = "Lobster.var",col_types = "nccncccccccccccccnnnncccccc")%>%
mutate(trip.day.trap=paste(Trip,Day,Trap.ID,sep="."))%>%  #Trap.ID
mutate(Source = 'ash-millers-masters')%>%
glimpse()
dat.length.2018<-dat.2018%>%
mutate(Count=1)%>% # Create count for abundance calcs
# I think we need to keep NA's in Carapace.length and tag.number BG 07/05/19
filter(!(is.na(Carapace.length)&is.na(Tag.number)&is.na(Colour)))%>% # now filters out where all are blank, 35 individuals have colour but no other details
mutate(Carapace.length=as.numeric(as.character(Carapace.length)))%>%
mutate(Colour=str_replace_all(.$Colour,c("W"="White", "R"="Red")))%>%
mutate(Sex=str_replace_all(.$Sex, c("M"="Male", "F"="Female","U"="Unknown")))%>%
mutate(Sex=if_else((!is.na(Colour)&!Sex%in%c("Female","Male")),"Unknown",Sex))%>%
# Fix Damaged data
mutate(Damage.old.a=if_else(Damage.new.a==9,0,Damage.old.a))%>%
mutate(Damage.new.L=if_else(Damage.new.a==9,0,Damage.new.L))%>%
mutate(Damage.old.L=if_else(Damage.new.a==9,0,Damage.old.L))%>%
mutate(Damage.new.a=if_else(Damage.new.a==9,0,Damage.new.a))%>%
replace_na(list(Damage.old.a = 0, Damage.old.L = 0,Damage.new.a = 0, Damage.new.L = 0,Sex="Unknown",Colour="Unknown"))%>%
mutate(Total.damage=(Damage.old.a+Damage.old.L+Damage.new.a+Damage.new.L))%>%
dplyr::select(-c(Date,Trap.Type,Day.Pull,Pot.Remarks,PWO,WKW,PWF,Source))%>%
glimpse()
# Things that should actually be in the metadata not the lobster data
additional.info<-dat.2018%>%
dplyr::select(Trip,Location,Trap.ID,Day,Date,Trap.Number,Trap.Type,Day.Pull,Pot.Remarks,PWO,WKW,PWF,trip.day.trap,Source)%>%
distinct()
test<-anti_join(additional.info,dat.pot.2018)
View(test)
test<-anti_join(additional.info,dat.pot.2018, by = c("Trip", "Trap.ID", "Day", "trip.day.trap"))
test<-anti_join(additional.info,dat.pot.2018, by = c("Trip", "Location", "Trap.ID", "Day", "trip.day.trap"))
View(additional.info)
test2<-anti_join(dat.pot.2018,additional.info, by = c("Trip", "Trap.ID", "Day", "trip.day.trap"))
View(test2)
duplicate.pots<-dat.pot.2018%>%
group_by(trip.day.trap)%>%
dplyr::summarise(n=n())%>%filter(n>1)
length(unique(dat.length.2018$trip.day.trap))
1440-1163
21+227+1163
missing.additional.info<-anti_join(dat.pot.2018,additional.info, by = c("Trip", "Trap.ID", "Day", "trip.day.trap"))
missing.field.info<-anti_join(dat.pot.2018,additional.info, by = c("Trip", "Trap.ID", "Day", "trip.day.trap"))
View(missing.field.info)
missing.from.lobster<-anti_join(additional.info,dat.pot.2018, by = c("Trip", "Location", "Trap.ID", "Day", "trip.day.trap"))
missing.from.lobster<-anti_join(additional.info,dat.pot.2018, by = c("Trip",  "Trap.ID", "Day", "trip.day.trap")) #"Location",
1440-1163
21+277+1163
## Pot numbers
# 1461 pots in total
# 1163 non-empty pots
# 21 are empty with out addtional info
# 277 are empty with additional info
277+21
duplicate.pots<-dat.pot.2018%>%
group_by(trip.day.trap)%>%
dplyr::summarise(n=n())%>%filter(n>1)
# Import 2018 pot data----
dat.pot.2018<-gs_title("Lobsters_data_2018_All")%>% # To use GoogleSheets
gs_read_csv(ws = "Pot.var",col_types = "nccnccnnccnnnc")%>%
mutate(trip.day.trap=paste(Trip,Day,Trap.ID,sep="."))%>%
#mutate(Site.Name=str_replace_all(.$Site.Name,c( "SM"="Seven Mile", "DM"="Davids Marks",  "RM"="Rivermouth", "IR"="Irwin Reef", "LR"="Long Reef", "SD"="South Dummy", "LH"="Little Horseshoe", "CHin1_"="Cliff Head Mid","CHin2_"="Cliff Head South","CHout1_" = "Cliff Head OUT1","CHout2_" = "Cliff Head North", "JB"="Jim Bailey", "GR"="Golden Ridge", "SR"="South Rig", "WL"="Whites Lump")))%>%
filter(Johns=="No")%>% # turn off when I add in john's data (if ever)
dplyr::rename(Latitude=Latitude.y, Longitude=Longitude.x)%>%
mutate(Latitude=as.numeric(Latitude))%>%
mutate(Longitude=as.numeric(Longitude))%>%
filter(!Comment%in%c("Duplicate"))%>%
glimpse()
# Import 2018 pot data----
dat.pot.2018<-gs_title("Lobsters_data_2018_All")%>% # To use GoogleSheets
gs_read_csv(ws = "Pot.var",col_types = "nccnccnnccnnnc")%>%
mutate(trip.day.trap=paste(Trip,Day,Trap.ID,sep="."))%>%
#mutate(Site.Name=str_replace_all(.$Site.Name,c( "SM"="Seven Mile", "DM"="Davids Marks",  "RM"="Rivermouth", "IR"="Irwin Reef", "LR"="Long Reef", "SD"="South Dummy", "LH"="Little Horseshoe", "CHin1_"="Cliff Head Mid","CHin2_"="Cliff Head South","CHout1_" = "Cliff Head OUT1","CHout2_" = "Cliff Head North", "JB"="Jim Bailey", "GR"="Golden Ridge", "SR"="South Rig", "WL"="Whites Lump")))%>%
filter(Johns=="No")%>% # turn off when I add in john's data (if ever)
dplyr::rename(Latitude=Latitude.y, Longitude=Longitude.x)%>%
mutate(Latitude=as.numeric(Latitude))%>%
mutate(Longitude=as.numeric(Longitude))%>%
filter(!Comment%in%c("Duplicate"))%>%
select(-c(Johns,Comment))%>%
glimpse()
unique(dat.pot.2018$Location)
unique(dat.pot.2018$Site.Name)
unique(dat.pot.2018$Location)%>%sort()
unique(dat.pot.2018$Site.Name)%>%sort()
# Import 2018 pot data----
dat.pot.2018<-gs_title("Lobsters_data_2018_All")%>% # To use GoogleSheets
gs_read_csv(ws = "Pot.var",col_types = "nccnccnnccnnnc")%>%
mutate(trip.day.trap=paste(Trip,Day,Trap.ID,sep="."))%>%
#mutate(Site.Name=str_replace_all(.$Site.Name,c( "SM"="Seven Mile", "DM"="Davids Marks",  "RM"="Rivermouth", "IR"="Irwin Reef", "LR"="Long Reef", "SD"="South Dummy", "LH"="Little Horseshoe", "CHin1_"="Cliff Head Mid","CHin2_"="Cliff Head South","CHout1_" = "Cliff Head OUT1","CHout2_" = "Cliff Head North", "JB"="Jim Bailey", "GR"="Golden Ridge", "SR"="South Rig", "WL"="Whites Lump")))%>%
filter(Johns=="No")%>% # turn off when I add in john's data (if ever)
dplyr::rename(Latitude=Latitude.y, Longitude=Longitude.x)%>%
mutate(Latitude=as.numeric(Latitude))%>%
mutate(Longitude=as.numeric(Longitude))%>%
filter(!Comment%in%c("Duplicate"))%>%
select(-c(Johns,Comment))%>%
glimpse()
unique(dat.pot.2018$Location)%>%sort()
unique(dat.pot.2018$Site.Name)%>%sort()
# Import 2018 pot data----
dat.pot.2018<-gs_title("Lobsters_data_2018_All")%>% # To use GoogleSheets
gs_read_csv(ws = "Pot.var",col_types = "nccnccnnccnnnc")%>%
mutate(trip.day.trap=paste(Trip,Day,Trap.ID,sep="."))%>%
mutate(New.Site.Name=str_replace_all(.$Site.Name,c( "SM"="Seven Mile", "DM"="Davids Marks",  "RM"="Rivermouth", "IR"="Irwin Reef", "LR"="Long Reef", "SD"="South Dummy", "LH"="Little Horseshoe", "CHin1_"="Cliff Head Mid","CHin2_"="Cliff Head South","CHout1_" = "Cliff Head OUT1","CHout2_" = "Cliff Head North", "JB"="Jim Bailey", "GR"="Golden Ridge", "SR"="South Rig", "WL"="Whites Lump")))%>%
filter(Johns=="No")%>% # turn off when I add in john's data (if ever)
dplyr::rename(Latitude=Latitude.y, Longitude=Longitude.x)%>%
mutate(Latitude=as.numeric(Latitude))%>%
mutate(Longitude=as.numeric(Longitude))%>%
filter(!Comment%in%c("Duplicate"))%>%
select(-c(Johns,Comment))%>%
glimpse()
unique(dat.pot.2018$New.Site.Name)%>%sort()
sites<-dat.pot.2018%>%
distinct(Location,Site.Name,New.Site.Name)
View(sites)
install.packages("gridExtra")
dat.pot.2018<-gs_title("Lobsters_data_2018_All")%>% # To use GoogleSheets
gs_read_csv(ws = "Pot.var",col_types = "nccnccnnccnnnc")
# Import 2018 pot data----
dat.pot.2018<-gs_title("Lobsters_data_2018_All")%>% # To use GoogleSheets
gs_read_csv(ws = "Pot.var",col_types = "nccnccnnccnnnc")%>%
mutate(trip.day.trap=paste(Trip,Day,Trap.ID,sep="."))%>%
mutate(Location=str_replace_all(.$Site.Name,c("Seven Mile Beach"= "Seven Mile","Little Horseshoe"="Cliff Head", "Cliff Head North"="Cliff Head","Cliff Head Mid"= "Cliff Head","Cliff Head South"="Cliff Head","Cliff Head OUT1"= "Cliff Head","CHM"="Cliff Head", "Davids Marks"="Cliff Head","CHM"= "Cliff Head", "CHS"="Cliff Head", "CHN"="Cliff Head", "Jim Bailey"="Irwin Reef", "Long Reef"="Irwin Reef", "South Dummy"="Irwin Reef","South Rig"= "Irwin Reef","Whites Lump"= "Irwin Reef","WP"= "Irwin Reef","Whitepoint"="Irwin Reef")))%>%
mutate(Site=str_replace_all(.$Site.Name, c("Jim Bailey"="White Point" ,"WP"="White Point" , "Whitepoint"="White Point" , "CHS"="Cliff Head South","CHM"="Cliff Head Mid","CHN"="Cliff Head North", "Seven Mile Beach"= "Seven Mile.out")))%>%
#mutate(New.Site.Name=str_replace_all(.$Site.Name,c( "SM"="Seven Mile", "DM"="Davids Marks",  "RM"="Rivermouth", "IR"="Irwin Reef", "LR"="Long Reef", "SD"="South Dummy", "LH"="Little Horseshoe", "CHin1_"="Cliff Head Mid","CHin2_"="Cliff Head South","CHout1_" = "Cliff Head OUT1","CHout2_" = "Cliff Head North", "JB"="Jim Bailey", "GR"="Golden Ridge", "SR"="South Rig", "WL"="Whites Lump")))%>%
filter(Johns=="No")%>% # turn off when I add in john's data (if ever)
dplyr::rename(Latitude=Latitude.y, Longitude=Longitude.x)%>%
mutate(Latitude=as.numeric(Latitude))%>%
mutate(Longitude=as.numeric(Longitude))%>%
filter(!Comment%in%c("Duplicate"))%>%
select(-c(Johns,Comment))%>%
glimpse()
unique(dat.pot.2018$Location)%>%sort()
# Import 2018 pot data----
dat.pot.2018<-gs_title("Lobsters_data_2018_All")%>% # To use GoogleSheets
gs_read_csv(ws = "Pot.var",col_types = "nccnccnnccnnnc")%>%
mutate(trip.day.trap=paste(Trip,Day,Trap.ID,sep="."))%>%
mutate(Location=str_replace_all(.$Site.Name,c("Seven Mile Beach"= "Seven Mile","Little Horseshoe"="Cliff Head", "Cliff Head North"="Cliff Head","Cliff Head Mid"= "Cliff Head","Cliff Head South"="Cliff Head","Cliff Head OUT1"= "Cliff Head","CHM"="Cliff Head", "Davids Marks"="Cliff Head","CHM"= "Cliff Head", "CHS"="Cliff Head", "CHN"="Cliff Head", "Jim Bailey"="Irwin Reef", "Long Reef"="Irwin Reef", "South Dummy"="Irwin Reef","South Rig"= "Irwin Reef","Whites Lump"= "Irwin Reef","WP"= "Irwin Reef","Whitepoint"="Irwin Reef")))%>%
mutate(Site=str_replace_all(.$Site.Name, c("Jim Bailey"="White Point" ,"WP"="White Point" , "Whitepoint"="White Point" , "CHS"="Cliff Head South","CHM"="Cliff Head Mid","CHN"="Cliff Head North", "Seven Mile Beach"= "Seven Mile.out")))%>%
#mutate(New.Site.Name=str_replace_all(.$Site.Name,c( "SM"="Seven Mile", "DM"="Davids Marks",  "RM"="Rivermouth", "IR"="Irwin Reef", "LR"="Long Reef", "SD"="South Dummy", "LH"="Little Horseshoe", "CHin1_"="Cliff Head Mid","CHin2_"="Cliff Head South","CHout1_" = "Cliff Head OUT1","CHout2_" = "Cliff Head North", "JB"="Jim Bailey", "GR"="Golden Ridge", "SR"="South Rig", "WL"="Whites Lump")))%>%
filter(Johns=="No")%>% # turn off when I add in john's data (if ever)
dplyr::rename(Latitude=Latitude.y, Longitude=Longitude.x)%>%
mutate(Latitude=as.numeric(Latitude))%>%
mutate(Longitude=as.numeric(Longitude))%>%
filter(!Comment%in%c("Duplicate"))%>%
select(-c(Johns,Comment))%>%
glimpse()
unique(dat.pot.2018$Location)%>%sort()
unique(dat.pot.2018$Site.Name)%>%sort()
# Import 2018 pot data----
dat.pot.2018<-gs_title("Lobsters_data_2018_All")%>% # To use GoogleSheets
gs_read_csv(ws = "Pot.var",col_types = "nccnccnnccnnnc")%>%
mutate(trip.day.trap=paste(Trip,Day,Trap.ID,sep="."))%>%
mutate(New.Site.Name=str_replace_all(.$Site.Name,c( "SM"="Seven Mile", "DM"="Davids Marks",  "RM"="Rivermouth", "IR"="Irwin Reef", "LR"="Long Reef", "SD"="South Dummy", "LH"="Little Horseshoe", "CHin1_"="Cliff Head Mid","CHin2_"="Cliff Head South","CHout1_" = "Cliff Head OUT1","CHout2_" = "Cliff Head North", "JB"="Jim Bailey", "GR"="Golden Ridge", "SR"="South Rig", "WL"="Whites Lump")))%>%
mutate(Site=str_replace_all(.$Site,c("Seven Mile Beach"= "Seven Mile","Little Horseshoe"="Cliff Head", "Cliff Head North"="Cliff Head","Cliff Head Mid"= "Cliff Head","Cliff Head South"="Cliff Head","Cliff Head OUT1"= "Cliff Head","CHM"="Cliff Head", "Davids Marks"="Cliff Head","CHM"= "Cliff Head", "CHS"="Cliff Head", "CHN"="Cliff Head", "Jim Bailey"="Irwin Reef", "Long Reef"="Irwin Reef", "South Dummy"="Irwin Reef","South Rig"= "Irwin Reef","Whites Lump"= "Irwin Reef","WP"= "Irwin Reef","Whitepoint"="Irwin Reef")))%>%
mutate(mini.site=str_replace_all(.$mini.site, c("Jim Bailey"="White Point" ,"WP"="White Point" , "Whitepoint"="White Point" , "CHS"="Cliff Head South","CHM"="Cliff Head Mid","CHN"="Cliff Head North", "Seven Mile Beach"= "Seven Mile.out")))%>%
filter(Johns=="No")%>% # turn off when I add in john's data (if ever)
dplyr::rename(Latitude=Latitude.y, Longitude=Longitude.x)%>%
mutate(Latitude=as.numeric(Latitude))%>%
mutate(Longitude=as.numeric(Longitude))%>%
filter(!Comment%in%c("Duplicate"))%>%
select(-c(Johns,Comment))%>%
glimpse()
# Import 2018 pot data----
dat.pot.2018<-gs_title("Lobsters_data_2018_All")%>% # To use GoogleSheets
gs_read_csv(ws = "Pot.var",col_types = "nccnccnnccnnnc")%>%
mutate(trip.day.trap=paste(Trip,Day,Trap.ID,sep="."))%>%
mutate(Site=str_replace_all(.$Site.Name,c( "SM"="Seven Mile", "DM"="Davids Marks",  "RM"="Rivermouth", "IR"="Irwin Reef", "LR"="Long Reef", "SD"="South Dummy", "LH"="Little Horseshoe", "CHin1_"="Cliff Head Mid","CHin2_"="Cliff Head South","CHout1_" = "Cliff Head OUT1","CHout2_" = "Cliff Head North", "JB"="Jim Bailey", "GR"="Golden Ridge", "SR"="South Rig", "WL"="Whites Lump")))%>%
mutate(Location=str_replace_all(.$Site,c("Seven Mile Beach"= "Seven Mile","Little Horseshoe"="Cliff Head", "Cliff Head North"="Cliff Head","Cliff Head Mid"= "Cliff Head","Cliff Head South"="Cliff Head","Cliff Head OUT1"= "Cliff Head","CHM"="Cliff Head", "Davids Marks"="Cliff Head","CHM"= "Cliff Head", "CHS"="Cliff Head", "CHN"="Cliff Head", "Jim Bailey"="Irwin Reef", "Long Reef"="Irwin Reef", "South Dummy"="Irwin Reef","South Rig"= "Irwin Reef","Whites Lump"= "Irwin Reef","WP"= "Irwin Reef","Whitepoint"="Irwin Reef")))%>%
mutate(Site=str_replace_all(.$Site, c("Jim Bailey"="White Point" ,"WP"="White Point" , "Whitepoint"="White Point" , "CHS"="Cliff Head South","CHM"="Cliff Head Mid","CHN"="Cliff Head North", "Seven Mile Beach"= "Seven Mile.out")))%>%
filter(Johns=="No")%>% # turn off when I add in john's data (if ever)
dplyr::rename(Latitude=Latitude.y, Longitude=Longitude.x)%>%
mutate(Latitude=as.numeric(Latitude))%>%
mutate(Longitude=as.numeric(Longitude))%>%
filter(!Comment%in%c("Duplicate"))%>%
select(-c(Johns,Comment))%>%
glimpse()
unique(dat.pot.2018$Location)%>%sort()
unique(dat.pot.2018$Site.Name)%>%sort()
unique(dat.pot.2018$Site)%>%sort()
